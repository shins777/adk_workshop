# ADK Conversation Agent - Session

This folder demonstrates how to build and operate a session-aware conversational AI agent using the Agent Development Kit (ADK). The example shows how to maintain session state across multiple user interactions while answering questions using Google Search.

Key features of the session conversation agent:
- Answers user questions using both its internal knowledge and live Google search results
- Maintains session state and event history across multiple turns
- Supports multiple session backends: in-memory, SQLite (database), and Agent Engine (Vertex AI)
- Prints detailed session properties and events after each turn

## .env configuration

Create a `.env` file in the parent folder (`02-context`). See the ADK quickstart for recommended environment variables and authentication instructions:
https://google.github.io/adk-docs/get-started/quickstart/#set-up-the-model

The example below shows environment variables used when running ADK with Vertex AI / Agent Engine in an enterprise environment. Note: the Gemini endpoint location and Agent Engine location can be configured independently.

```
GOOGLE_GENAI_USE_VERTEXAI = TRUE
GOOGLE_CLOUD_PROJECT = "YOUR_PROJECT_ID"
GOOGLE_CLOUD_LOCATION = "YOUR_PROJECT_LOCATION"
GOOGLE_GENAI_MODEL = "gemini-2.5-flash"

AGENT_ENGINE_ID = "YOUR_AGENT_ENGINE_ID"
```

For individual users using AI Studio, set the API key like this:

```
GOOGLE_GENAI_USE_VERTEXAI = FALSE
GOOGLE_API_KEY = PASTE_YOUR_ACTUAL_API_KEY_HERE
```

## Example: run the demo

Authenticate your environment with Google Cloud:

```
adk_workshop/adk/02-context$gcloud auth application-default login
```

Run the session agent with one of the supported session backends:

```
adk_workshop/adk/02-context$ uv run -m session.runner --type <session_type> --app_name <app_name> --user_id <user_id> --session_id <session_id>
```

Available session types: `in_memory`, `database`, `agent_engine`

The server will create a session automatically on first run. While the session exists, subsequent interactions can reference the conversation history and session state. When using `database` or `agent_engine`, session data persists across process restarts as long as you reuse the same app name, user id, and session id.

### 1) in_memory session type

This mode stores sessions only in memory. All session data is lost when the process exits. Use this mode for quick local testing.

Example:

```
adk_workshop/adk/02-context$ uv run -m session.runner --type in_memory --app_name ai_assist --user_id forus --session_id forus_sess_001
```

### 2) database session type

This mode persists sessions to a relational database (example uses SQLite). Session state survives process restarts.

Example:

```
adk_workshop/adk/02-context$ uv run -m session.runner --type database --app_name ai_assist --user_id forus --session_id forus_sess_001
```

If using SQLite, a file (e.g., `adk_database.db`) will be created. You can inspect it with a SQLite viewer or VS Code extension.

### 3) agent_engine (Vertex AI) session type

This mode stores sessions in a Vertex AI Agent Engine instance. Agent Engine is a separately deployed service (e.g., Cloud Run) designed to host agents and their sessions. To use this mode, create an Agent Engine and set its ID in your `.env` file:

```
AGENT_ENGINE_ID = "1769934533233804800"
```

Example run command:

```
adk_workshop/adk/02-context$ uv run -m session.runner --type agent_engine --app_name ai_assist --user_id forus --session_id forus_sess_001
```

Notes when using VertexAiSessionService (as of Aug 2025, google-adk==1.12.0):
- VertexAiSessionService supports creating sessions based on session id.
- Sessions can be queried and resumed using `app_name`, `user_id`, and `session_id`.
- Session id is automatically generated by the example if not supplied.

## License

This project is licensed under the Apache License 2.0. All code and content copyright
